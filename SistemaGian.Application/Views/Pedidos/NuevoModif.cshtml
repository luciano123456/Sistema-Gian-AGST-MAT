@{
    ViewBag.Title = "Nuevo Pedido";
}
<title>@ViewBag.Title</title>

<partial name="~/Views/Utils/Modals.cshtml" />

@section Estilos {
    <!-- DataTables / Buttons / FixedHeader / FontAwesome / Select2 -->
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/fixedheader/3.2.2/css/fixedHeader.dataTables.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />

    <!-- SKIN NUEVO (igual que tu otro sistema) -->
    <link href="~/css/PedidosNuevoModif.css" rel="stylesheet" />
    <link href="~/css/RedisenoPantallas.css" rel="stylesheet" />
}


<partial name="~/Views/Shared/Partials/BotonMenu.cshtml" />

<!-- KPI superior -->
<header class="cc-kpi cc-card cc-container-xxl">
    <div class="cc-kpi-icon"><i class="fa fa-file-text-o"></i></div>
    <div class="cc-kpi-text">
        <h1 id="titulopedido" class="cc-kpi-title">Nuevo Pedido</h1>
        <p class="cc-muted m-0">Registro y edición de pedidos</p>
    </div>
    <button type="button" class="btn btn-outline-light ms-auto" onclick="window.location.href='/Pedidos'">
        <i class="fa fa-angle-left me-2"></i> Volver a Pedidos
    </button>
</header>

<img id="logoImpresion1" src="~/Imagenes/Logo2.png" style="display:none;" />
<img id="logoImpresion2" src="~/Imagenes/Logo3.png" style="display:none;" />

<main class="cc-container-xxl">

    <!-- ===== Tabs superiores (mismos IDs) ===== -->
    <ul class="nav nav-tabs cc-tabs pestaniasDatos" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link active" id="cliente-tab" data-bs-toggle="tab" href="#cliente" role="tab"
               aria-controls="cliente" aria-selected="true">Datos del Cliente</a>
        </li>
        <li class="nav-item" role="presentation" id="divDatosProveedor">
            <a class="nav-link" id="proveedor-tab" data-bs-toggle="tab" href="#proveedor" role="tab"
               aria-controls="proveedor" aria-selected="true">Datos del Proveedor</a>
        </li>
        <li class="nav-item" role="presentation" id="divDatosPedido" hidden>
            <a class="nav-link" id="pedido-tab" data-bs-toggle="tab" href="#pedido" role="tab"
               aria-controls="pedido" aria-selected="false">Datos del Pedido</a>
        </li>
    </ul>

    <div class="tab-content mt-4" id="myTabContent">

        <!-- ===== Cliente ===== -->
        <section class="tab-pane fade show active" id="cliente" role="tabpanel" aria-labelledby="cliente-tab">
            <div class="cc-section cc-card">
                <div class="cc-titlebar"><h3 class="m-0"><i class="fa fa-user me-2"></i>Datos del Cliente</h3></div>

                <input type="hidden" id="idCliente" name="idCliente" />
                <div class="cc-grid cc-grid-3xl">
                    <div class="form-group">
                        <label for="Clientes" class="form-label">Cliente</label>
                        <select id="Clientes" class="form-select bg-white text-black border-primary">
                            <option value="" selected>Seleccione Cliente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dniCliente" class="form-label">DNI</label>
                        <input type="text" id="dniCliente" class="form-control bg-white text-black border-primary" />
                    </div>
                    <div class="form-group">
                        <label for="telefonoCliente" class="form-label">Teléfono</label>
                        <input type="text" id="telefonoCliente" class="form-control bg-white text-black border-primary" />
                    </div>
                    <div class="form-group">
                        <label for="direccionCliente" class="form-label">Dirección</label>
                        <input type="text" id="direccionCliente" class="form-control bg-white text-black border-primary" />
                    </div>
                    <span id="lblSaldoCliente" hidden></span>
                </div>
            </div>
        </section>

        <!-- ===== Proveedor ===== -->
        <section class="tab-pane fade show" id="proveedor" role="tabpanel" aria-labelledby="proveedor-tab">
            <div class="cc-section cc-card">
                <div class="cc-titlebar"><h3 class="m-0"><i class="fa fa-truck me-2"></i>Datos del Proveedor</h3></div>

                <input type="hidden" id="idProveedor" name="idProveedor" />
                <div class="cc-grid cc-grid-3xl">
                    <div class="form-group">
                        <label for="Proveedores" class="form-label">Nombre</label>
                        <select id="Proveedores" class="form-select bg-white text-black border-primary">
                            <option value="" selected>Seleccione Proveedor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="apodoProveedor" class="form-label">Apodo</label>
                        <input type="text" id="apodoProveedor" class="form-control bg-white text-black border-primary" readonly />
                    </div>
                    <div class="form-group">
                        <label for="direccionProveedor" class="form-label">Dirección</label>
                        <input type="text" id="direccionProveedor" class="form-control bg-white text-black border-primary" readonly />
                    </div>
                    <div class="form-group">
                        <label for="telefonoProveedor" class="form-label">Teléfono</label>
                        <input type="text" id="telefonoProveedor" class="form-control bg-white text-black border-primary" readonly />
                    </div>
                </div>
            </div>
        </section>

        <!-- ===== Datos del Pedido ===== -->
        <section class="tab-pane fade" id="pedido" role="tabpanel" aria-labelledby="pedido-tab">
            <div class="cc-section cc-card">
                <div class="cc-titlebar"><h3 class="m-0"><i class="fa fa-list-ul me-2"></i>Datos del Pedido</h3></div>

                <input type="hidden" id="IdPedido" name="IdPedido" />
                <input type="hidden" id="idZona" name="idZona" />

                <div class="cc-grid cc-grid-3xl">
                    <div class="form-group ocultarmodoVendedor">
                        <label for="fechaPedido" class="form-label">Fecha</label>
                        <input type="date" id="fechaPedido" class="form-control bg-white text-black border-primary" />
                    </div>
                    <div class="form-group">
                        <label for="fechaEntrega" class="form-label">Fecha Entrega</label>
                        <input type="date" id="fechaEntrega" class="form-control bg-white text-black border-primary" />
                    </div>
                    <div class="form-group ocultarmodoVendedor">
                        <label for="nroRemito" class="form-label">Nro Partida</label>
                        <input type="text" id="nroRemito" class="form-control bg-white text-black border-primary" />
                    </div>
                    <div class="form-group ocultarmodoVendedor">
                        <label for="Zonas" class="form-label">Zona</label>
                        <select id="Zonas" class="form-select bg-white text-black border-primary">
                            <option value="" selected>Seleccione Zona</option>
                        </select>
                    </div>
                    <div class="form-group ocultarmodoVendedor">
                        <label for="Choferes" class="form-label">Chofer</label>
                        <select id="Choferes" class="form-select bg-white text-black border-primary">
                            <option value="" selected>Seleccione Chofer</option>
                        </select>
                    </div>
                    <div class="form-group ocultarmodoVendedor">
                        <label for="costoFlete" class="form-label">Costo Flete</label>
                        <input type="text" id="costoFlete" class="form-control bg-white text-black border-primary" placeholder="$0.00" value="$0.00" />
                    </div>
                    <div class="form-group ocultarmodoVendedor">
                        <label for="totalGanancia" class="form-label">Total Ganancia</label>
                        <input type="text" id="totalGanancia" class="form-control bg-white text-black border-primary" placeholder="$0.00" readonly />
                    </div>
                    <div class="form-group ocultarmodoVendedor">
                        <label for="porcGanancia" class="form-label">Porc. Ganancia</label>
                        <input type="text" id="porcGanancia" class="form-control bg-white text-black border-primary" placeholder="$0.00" readonly />
                    </div>
                    <div class="form-group">
                        <label for="estado" class="form-label">Estado</label>
                        <select id="estado" class="form-select bg-white text-black border-primary">
                            <option value="Pendiente" selected>Pendiente</option>
                            <option value="Entregado">Entregado</option>
                        </select>
                    </div>
                    <div class="form-group full">
                        <label for="observacion" class="form-label">Observación</label>
                        <input type="text" id="observacion" class="form-control bg-white text-black border-primary" />
                    </div>
                </div>
            </div>

            <!-- Detalle de pagos -->
            <div class="cc-section cc-card mt-4">
                <div class="cc-titlebar"><h3 class="m-0"><i class="fa fa-credit-card me-2"></i>Detalle de Pagos</h3></div>
                <div class="cc-grid cc-grid-3xl">
                    <div class="form-group ocultarmodoVendedor">
                        <label for="totalPagoProveedor" class="form-label">Total a pagar a proveedor</label>
                        <input type="text" id="totalPagoProveedor" class="form-control bg-white text-black border-primary" readonly />
                    </div>
                    <div class="form-group ocultarmodoVendedor">
                        <label for="totalPagadoaProveedor" class="form-label">Total pagado a proveedor</label>
                        <input type="text" id="totalPagadoaProveedor" class="form-control bg-white text-black border-primary" readonly />
                    </div>
                    <div class="form-group ocultarmodoVendedor">
                        <label for="restanteProveedor" class="form-label">Total restante proveedor</label>
                        <input type="text" id="restanteProveedor" class="form-control bg-white text-black border-primary" readonly />
                    </div>
                    <div class="form-group">
                        <label for="totalPagoCliente" class="form-label">Total a pagar el cliente</label>
                        <input type="text" id="totalPagoCliente" class="form-control bg-white text-black border-primary" readonly />
                    </div>
                    <div class="form-group">
                        <label for="totalPagadoCliente" class="form-label">Total pago cliente</label>
                        <input type="text" id="totalPagadoCliente" class="form-control bg-white text-black border-primary" readonly />
                    </div>
                    <div class="form-group">
                        <label for="restanteCliente" class="form-label">Total restante cliente</label>
                        <input type="text" id="restanteCliente" class="form-control bg-white text-black border-primary" readonly />
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- ===== Tabs inferiores: Productos / Pagos ===== -->
    <ul class="nav nav-tabs cc-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link active" id="productos-tab" data-bs-toggle="tab" href="#productos" role="tab"
               aria-controls="productos-tab" aria-selected="true">Productos</a>
        </li>
        <li class="nav-item " role="presentation">
            <a class="nav-link" id="cliente-pagos-tab" data-bs-toggle="tab" href="#cliente-pagos" role="tab"
               aria-controls="cliente-pagos" aria-selected="false">Pagos del Cliente</a>
        </li>
        <li class="nav-item ocultarmodoVendedor" role="presentation">
            <a class="nav-link" id="proveedor-pagos-tab" data-bs-toggle="tab" href="#proveedor-pagos" role="tab"
               aria-controls="proveedor-pagos" aria-selected="false">Pagos a Proveedor</a>
        </li>
    </ul>

    <div class="tab-content mt-4" id="myTabContent">
        <!-- Productos -->
        <section class="tab-pane fade show active" id="productos" role="tabpanel" aria-labelledby="productos-tab">
            <div class="cc-section cc-card">
                <div class="cc-titlebar">
                    <h3 class="m-0"><i class="fa fa-cubes me-2"></i>Productos</h3>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-primary" onclick="anadirProducto()">
                            <i class="fa fa-plus me-1"></i> Añadir
                        </button>
                    </div>
                </div>

                <div class="cc-table">
                    <table class="display nowrap table w-100" id="grd_Productos" style="width:100%">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Precio Costo</th>
                                <th>Precio Venta</th>
                                <th>Cantidad de Productos</th>
                                <th>Cantidad</th>
                                <th>Cant. Acopio</th>
                                <th>Total</th>
                                <th>Peso</th>
                                <th>Unidad Medida</th>
                                <th>Observacion</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Pagos Cliente -->
        <section class="tab-pane fade" id="cliente-pagos" role="tabpanel" aria-labelledby="cliente-pagos-tab">
            <div class="cc-section cc-card">
                <div class="cc-titlebar"><h3 class="m-0"><i class="fa fa-money me-2"></i>Pagos del Cliente</h3></div>
                <div class="cc-table">
                    <table class="display nowrap table w-100" id="grd_pagosClientes" style="width:100%">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th hidden>IdMoneda</th>
                                <th>Moneda</th>
                                <th>Cotizacion</th>
                                <th>Total</th>
                                <th>TotalARS</th>
                                <th>Observacion</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="d-flex justify-content-end mt-3">
                    <button type="button" class="btn btn-success" onclick="anadirPago('Cliente')">
                        <i class="fa fa-plus"></i> Añadir
                    </button>
                </div>
            </div>
        </section>

        <!-- Pagos Proveedor -->
        <section class="tab-pane fade" id="proveedor-pagos" role="tabpanel" aria-labelledby="proveedor-pagos-tab">
            <div class="cc-section cc-card">
                <div class="cc-titlebar"><h3 class="m-0"><i class="fa fa-handshake-o me-2"></i>Pagos a Proveedor</h3></div>
                <div class="cc-table">
                    <table class="display nowrap table w-100" id="grd_pagosaProveedores" style="width:100%">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th hidden>IdMoneda</th>
                                <th>Moneda</th>
                                <th>Cotizacion</th>
                                <th>Total</th>
                                <th>TotalARS</th>
                                <th>Observacion</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="d-flex justify-content-end mt-3">
                    <button type="button" class="btn btn-success" onclick="anadirPago('Proveedor')">
                        <i class="fa fa-plus"></i> Añadir
                    </button>
                </div>
            </div>
        </section>
    </div>

    <div class="d-flex justify-content-end gap-2 my-3">
        <button type="button" id="btnGenerarPdf" class="btn btn-danger" onclick="generarDatosPedidoPDF()">
            <i class="fa fa-print me-1"></i> Imprimir PDF
        </button>
        <button type="button" id="btnGenerarRemito" class="btn btn-dark" onclick="generarDatosRemitoPDF()">
            <i class="fa fa-print me-1"></i> Imprimir Remito
        </button>
        <button type="submit" id="btnNuevoModificar" class="btn btn-primary" onclick="guardarCambios()">
            <i class="fa fa-save me-1"></i> Registrar
        </button>
    </div>
</main>

<!-- ===== Modales de selección (mismos IDs) ===== -->
<div id="proveedorModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="proveedorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content cc-modal">
            <div class="modal-header cc-modal-header">
                <h5 class="modal-title" id="proveedorModalLabel">Seleccionar Proveedor</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <div class="cc-table">
                    <table id="tablaProveedores" class="table table-striped table-bordered w-100">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Nombre</th>
                                <th>Apodo</th>
                                <th>Direccion</th>
                                <th>Telefono</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="modal-footer modal-footer-cc">
                <button type="button" class="btn btn-success" id="btnSeleccionarProveedorModal"><i class="fa fa-check"> Seleccionar</i></button>
            </div>
        </div>
    </div>
</div>

<div id="clienteModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="clienteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content cc-modal">
            <div class="modal-header cc-modal-header">
                <h5 class="modal-title" id="proveedorModalLabel">Seleccionar Cliente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <div class="cc-table">
                    <table id="tablaClientes" class="table table-striped table-bordered w-100">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Nombre</th>
                                <th>Dni</th>
                                <th>Direccion</th>
                                <th>Telefono</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="modal-footer modal-footer-cc">
                <button type="button" class="btn btn-success" id="btnSeleccionarClienteModal"><i class="fa fa-check"> Seleccionar</i></button>
            </div>
        </div>
    </div>
</div>

<div id="choferModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="choferModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content cc-modal">
            <div class="modal-header cc-modal-header">
                <h5 class="modal-title" id="proveedorModalLabel">Seleccionar Chofer</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <div class="cc-table">
                    <table id="tablaChoferes" class="table table-striped table-bordered w-100">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Nombre</th>
                                <th>Direccion</th>
                                <th>Telefono</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="modal-footer modal-footer-cc">
                <button type="button" class="btn btn-success" id="btnSeleccionarChofer"><i class="fa fa-check"> Seleccionar</i></button>
            </div>
        </div>
    </div>
</div>

<div id="zonaModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="zonaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content cc-modal">
            <div class="modal-header cc-modal-header">
                <h5 class="modal-title" id="proveedorModalLabel">Seleccionar Zona</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <div class="cc-table">
                    <table id="tablaZonas" class="table table-striped table-bordered w-100">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Nombre</th>
                                <th>Precio</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="modal-footer modal-footer-cc">
                <button type="button" class="btn btn-success" id="btnSeleccionarZona"><i class="fa fa-check"> Seleccionar</i></button>
            </div>
        </div>
    </div>
</div>

<!-- ================ MODAL: PRODUCTO ================= -->
<div class="modal fade" id="productosModal" tabindex="-1" role="dialog" aria-labelledby="productosModalLabel" aria-hidden="true" data-editing="false">
    <div class="modal-dialog modal-xxl modal-dialog-centered modal-dialog-scrollable">
        <!-- ← antes era modal-xl -->
        <div class="modal-content cc-modal cc-modal--elevated">

            <div class="modal-header cc-modal-header">
                <div class="d-flex align-items-center gap-1">
                    <span class="cc-badge"><i class="fa fa-cube"></i></span>
                    <h5 class="modal-title fw-bold m-0" id="productosModalLabel">Seleccionar Producto</h5>
                </div>
                <button type="button" class="btn-close custom-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <!-- SACÁ p-0 o dejalo, el CSS de abajo ya agrega padding -->
            <div class="modal-body">
                <!-- Agrego el modificador de una sola columna -->
                <div class="cc-modal-grid cc-modal-grid--single">
                    <div class="cc-pane">
                        <div class="cc-pane-title">Detalle del producto</div>

                        <!-- ids ocultos -->
                        <input type="text" class="form-control" id="ProductoModalId" hidden>
                        <input type="text" class="form-control" id="ProductoEditandoModalId" hidden>

                        <div class="cc-form-grid cc-form-producto">
                            <div class="cc-field full">
                                <label class="form-label">Producto</label>
                                <select id="productoSelect" class="form-control"></select>
                            </div>

                            <div class="cc-field full">
                                <label class="form-label">Historial de Precios</label>
                                <select id="precioSelect" class="form-control"></select>
                            </div>

                            <div class="cc-field">
                                <label for="precioInput" class="form-label">Precio Manual</label>
                                <input type="text" id="precioInput" class="form-control" placeholder="Ingrese precio manual" step="0.01">
                            </div>

                            <div class="cc-field">
                                <label for="productoUnidadMedida" class="form-label">Unidad de Medida</label>
                                <input type="text" id="productoUnidadMedida" class="form-control" readonly>
                            </div>

                            <div class="cc-field">
                                <label for="productoCantidad" class="form-label">Cant. de Productos</label>
                                <input type="text" id="productoCantidad" class="form-control" placeholder="1" step="0.01" readonly>
                            </div>

                            <div class="cc-field">
                                <label for="cantidadInput" class="form-label">Cantidad</label>
                                <input type="text" id="cantidadInput" class="form-control" placeholder="Ingrese cantidad">
                            </div>

                            <div class="cc-field" id="divCantidadAcopio" hidden>
                                <label for="cantidadAcopioInput" class="form-label">Cantidad de Acopio</label>
                                <input type="number" id="cantidadAcopioInput" class="form-control" placeholder="0" min="0">
                                <label id="lblStockDisponible" class="form-label text-info"></label>
                            </div>

                            <div class="cc-field">
                                <label class="form-label">Color</label>
                                <select id="Colores" class="form-select"></select>
                            </div>

                            <div class="cc-field">
                                <label for="totalInput" class="form-label">Cantidad Total</label>
                                <input type="text" id="totalInput" class="form-control" disabled>
                            </div>

                            <label id="totalBarras" class="form-label" hidden></label>
                        </div>

                        <!-- Panel cálculo (IVA/Ganancia) -->
                        <div id="detalleFacturaIVA" class="cc-stats" style="display:none;">
                            <div class="cc-stat-row">
                                <div class="cc-stat">
                                    <span class="cc-stat-label">Fac. IVA</span>
                                    <span id="facIVA" class="cc-stat-value text-success"></span>
                                </div>
                                <div class="cc-stat">
                                    <span class="cc-stat-label">Fac. SIN IVA</span>
                                    <span id="facSinIVA" class="cc-stat-value"></span>
                                </div>
                            </div>

                            <div class="cc-stat-row">
                                <div class="cc-stat">
                                    <span class="cc-stat-label">% Precio Proveedor</span>
                                    <span id="precioProveedor" class="badge bg-info"></span>
                                </div>
                                <div class="cc-stat">
                                    <span class="cc-stat-label">% Precio Venta</span>
                                    <span id="precioVenta" class="badge bg-warning text-dark"></span>
                                </div>
                            </div>

                            <div class="cc-stat-row">
                                <div class="cc-stat">
                                    <span class="cc-stat-label">Venta</span>
                                    <span id="venta" class="cc-stat-value text-primary"></span>
                                </div>
                                <div class="cc-stat">
                                    <span class="cc-stat-label">Costo</span>
                                    <span id="costo" class="cc-stat-value text-danger"></span>
                                </div>
                                <div class="cc-stat">
                                    <span class="cc-stat-label">Ganancia</span>
                                    <span id="ganancia" class="cc-stat-value text-success"></span>
                                </div>
                            </div>
                        </div>

                    </div><!-- /DERECHA -->
                </div><!-- /grid -->
            </div>

            <!-- Footer -->
            <div class="modal-footer cc-modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" id="btnGuardarProducto" class="btn btn-primary" onclick="guardarProducto()">
                    <i class="fa fa-check me-1"></i> Añadir Producto
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ================ MODAL: PAGO CLIENTE ================= -->
<div class="modal fade" id="pagosClienteModal" tabindex="-1" role="dialog" aria-labelledby="pagosClienteModalLabel" aria-hidden="true" data-editing="false">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content cc-modal cc-modal--elevated">
            <div class="modal-header cc-modal-header">
                <div class="d-flex align-items-center gap-2">
                    <span class="cc-badge"><i class="fa fa-money"></i></span>
                    <h5 class="modal-title fw-bold m-0" id="pagosClienteModalLabel">Pago de cliente</h5>
                </div>
                <button type="button" class="btn-close custom-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <div class="modal-body">
                <form class="cc-form-grid cc-form-2col">
                    <div class="cc-field">
                        <label class="form-label">Fecha del pago</label>
                        <input type="date" id="fechapagoCliente" class="form-control">
                    </div>

                    <div class="cc-field">
                        <label class="form-label">Moneda</label>
                        <select id="MonedasPagoCliente" class="form-control"></select>
                    </div>

                    <div class="cc-field">
                        <label class="form-label">Cotización</label>
                        <input type="text" id="cotizacionPagoCliente" class="form-control" step="0.01">
                    </div>

                    <div class="cc-field">
                        <label class="form-label">Cantidad</label>
                        <input type="number" id="cantidadPagoCliente" class="form-control">
                    </div>

                    <div class="cc-field">
                        <label class="form-label">Total ARS</label>
                        <input type="text" id="totalARSPagoCliente" class="form-control" disabled>
                    </div>

                    <div class="cc-field">
                        <label class="form-label">Observaciones</label>
                        <input type="text" id="observacionPagoCliente" class="form-control">
                    </div>

                    <div class="cc-field full" id="divSaldoFavor" hidden>
                        <div class="cc-callout">
                            <div class="form-check m-0">
                                <input type="checkbox" class="form-check-input fs-5" id="usarSaldoFavor">
                                <label class="form-check-label fs-6 ms-2" for="usarSaldoFavor">Usar del saldo a favor</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer cc-modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" id="btnGuardarPagoCliente" class="btn btn-primary" onclick="guardarPago('Cliente')">
                    <i class="fa fa-check me-1"></i> Añadir Pago
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ================ MODAL: PAGO PROVEEDOR ================= -->
<div class="modal fade" id="pagosProveedorModal" tabindex="-1" role="dialog" aria-labelledby="pagosProveedorModalLabel" aria-hidden="true" data-editing="false">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content cc-modal cc-modal--elevated">
            <div class="modal-header cc-modal-header">
                <div class="d-flex align-items-center gap-2">
                    <span class="cc-badge"><i class="fa fa-credit-card"></i></span>
                    <h5 class="modal-title fw-bold m-0" id="pagosProveedorModalLabel">Pago de proveedor</h5>
                </div>
                <button type="button" class="btn-close custom-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <div class="modal-body">
                <form class="cc-form-grid cc-form-2col">
                    <div class="cc-field">
                        <label class="form-label">Fecha del pago</label>
                        <input type="date" id="fechapagoProveedor" class="form-control">
                    </div>

                    <div class="cc-field">
                        <label class="form-label">Moneda</label>
                        <select id="MonedasPagoProveedor" class="form-control"></select>
                    </div>

                    <div class="cc-field">
                        <label class="form-label">Cotización</label>
                        <input type="text" id="cotizacionPagoProveedor" class="form-control" step="0.01">
                    </div>

                    <div class="cc-field">
                        <label class="form-label">Cantidad</label>
                        <input type="number" id="cantidadPagoProveedor" class="form-control">
                    </div>

                    <div class="cc-field">
                        <label class="form-label">Total ARS</label>
                        <input type="text" id="totalARSPagoProveedor" class="form-control" disabled>
                    </div>

                    <div class="cc-field">
                        <label class="form-label">Observaciones</label>
                        <input type="text" id="observacionPagoProveedor" class="form-control">
                    </div>
                </form>
            </div>

            <div class="modal-footer cc-modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" id="btnGuardarPagoProveedor" class="btn btn-primary" onclick="guardarPago('Proveedor')">
                    <i class="fa fa-check me-1"></i> Añadir Pago
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
@section Scripts {
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    <script src="~/js/utils/moment.js"></script>
    <script src="~/js/pedidosnuevomodif.js?v=3.9"></script>
    <script src="~/js/site.js"></script>
}

<script>
    var pedidoData = @Html.Raw(Json.Serialize(ViewBag.Data ?? new { }));
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.0/jspdf.plugin.autotable.min.js"></script>
